<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Silent Coach</title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0b1020" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: radial-gradient(circle at top left, #1e293b, #020617);
      color: #e5e7eb;
      text-align: center;
    }

    h1 { margin-top: 24px; }

    button {
      padding: 14px 22px;
      margin: 8px;
      font-size: 16px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
    }

    #startBtn { background: #2563eb; color: #fff; }
    #stopBtn { background: #7c2d12; color: #fff; }

    textarea {
      width: 90%;
      height: 140px;
      margin-top: 12px;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.05);
      color: #e5e7eb;
      font-size: 15px;
    }

    .status {
      margin-top: 10px;
      opacity: 0.8;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h1>Silent Coach</h1>

  <button id="startBtn">ðŸŽ¤ Start</button>
  <button id="stopBtn">â›” Stop</button>

  <div class="status" id="status">ëŒ€ê¸° ì¤‘...</div>

  <textarea id="interim" placeholder="ì‹¤ì‹œê°„ ì „ì‚¬ (interim)"></textarea>
  <textarea id="final" placeholder="ìµœì¢… ì „ì‚¬ (final)"></textarea>

<script>
(() => {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (Chrome ì‚¬ìš© ê¶Œìž¥)");
    return;
  }

  let recognition = null;
  let recognizing = false;

  const startBtn = document.getElementById("startBtn");
  const stopBtn  = document.getElementById("stopBtn");
  const statusEl = document.getElementById("status");
  const interimEl = document.getElementById("interim");
  const finalEl = document.getElementById("final");

  function createRecognition() {
    recognition = new SpeechRecognition();
    recognition.lang = "ko-KR";
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onstart = () => {
      recognizing = true;
      statusEl.textContent = "ðŸŽ™ï¸ ë“£ëŠ” ì¤‘...";
    };

    recognition.onend = () => {
      recognizing = false;
      statusEl.textContent = "â¸ï¸ ì¤‘ì§€ë¨";
    };

    recognition.onerror = (e) => {
      console.error(e);
      statusEl.textContent = "âš ï¸ ì˜¤ë¥˜ ë°œìƒ";
    };

    recognition.onresult = (event) => {
      let interim = "";
      let finalText = "";

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const txt = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalText += txt + " ";
        } else {
          interim += txt;
        }
      }

      interimEl.value = interim;
      if (finalText) {
        finalEl.value += finalText;
      }
    };
  }

  // â­ ëª¨ë°”ì¼ í•µì‹¬ í¬ì¸íŠ¸
  // ë°˜ë“œì‹œ "ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì•ˆì—ì„œ" start() ì‹¤í–‰
  startBtn.addEventListener("click", () => {
    if (recognizing) return;

    createRecognition();     // ìƒˆ ê°ì²´ ìƒì„±
    recognition.start();     // ì¦‰ì‹œ ì‹¤í–‰ (ë¹„ë™ê¸°/íƒ€ì´ë¨¸ âŒ)
  });

  stopBtn.addEventListener("click", () => {
    if (recognition && recognizing) {
      recognition.stop();
    }
  });
})();
</script>

</body>
</html>
